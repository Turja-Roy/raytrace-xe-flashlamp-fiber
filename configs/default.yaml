# Default configuration for raytrace-xe-flashlamp-fiber
# All physical units: mm, nm, radians (not degrees except where noted)

# Ray tracing parameters
rays:
  n_rays: 1000  # Number of rays per optimization trial
  use_vectorized: true  # Use vectorized ray tracing (10-15x faster)

# Wavelength and optical properties
optics:
  wavelength_nm: 200.0  # VUV wavelength

# Source geometry (xenon flashlamp)
source:
  arc_diameter_mm: 3.0      # Arc source diameter
  window_diameter_mm: 14.3  # Window diameter
  window_distance_mm: 8.7   # Distance from arc to window
  max_angle_deg: 33         # Maximum ray angle at window edge

# Fiber parameters
fiber:
  core_diameter_mm: 1.0  # 1000 micron core
  numerical_aperture: 0.22

# Medium properties (air, argon, or helium)
medium:
  type: air               # Options: 'air', 'argon', 'helium'
  pressure_atm: 1.0       # Atmospheric pressure
  temperature_k: 293.15   # Room temperature (20°C)
  humidity_fraction: 0.01 # Relative humidity (1%)

# Optimization settings
optimization:
  method: powell          # Options: 'powell', 'grid', 'nelder_mead', 'differential_evolution', 'dual_annealing', 'bayesian'
  
  # Powell-specific settings
  powell:
    maxiter: 1000
    ftol: 0.0001
  
  # Grid search settings
  grid:
    z_l1_min: 10.0
    z_l1_max: 30.0
    z_l1_steps: 5
    z_l2_min: 20.0
    z_l2_max: 40.0
    z_l2_steps: 5
    z_fiber_min: 30.0
    z_fiber_max: 50.0
    z_fiber_steps: 5
  
  # Differential evolution settings
  differential_evolution:
    maxiter: 100
    popsize: 15
    
  # Dual annealing settings
  dual_annealing:
    maxiter: 1000
    
  # Bayesian optimization settings
  bayesian:
    n_calls: 100
    n_initial_points: 10

# Output settings
output:
  results_dir: results
  plots_dir: plots
  log_dir: logs
  save_plots: true
  save_csv: true
  plot_style: '2d'  # Options: '2d', '3d', 'both'
  orientation: 'SfccfF'  # Options: 'ScffcF', 'SfccfF', 'both'

# Database settings
database:
  enabled: true  # Enable SQLite database for storing results
  path: ./results/optimization.db  # Path to database file

# Tolerance analysis settings
tolerance:
  z_range_mm: 1.0       # Range of z-displacement to test (±mm from optimal)
  n_samples: 21         # Number of displacement samples (should be odd)
  n_rays: 2000          # Rays per tolerance test (higher = more accurate)
  test_lateral: true   # Test x/y lateral displacements (future feature)
  test_tilt: true      # Test angular tilts (future feature)

# Batch tolerance analysis settings (for tolerance batch mode)
batch_tolerance:
  results_file: results/2025-11-07_combine_differential_evolution_argon/results_combine_2025-11-07_combine_differential_evolution_argon.csv                  # Path to optimization results CSV (null = required on CLI)
  coupling_threshold: 0.35            # Minimum coupling efficiency to include in analysis

# Analysis settings (for analyze mode - re-optimize high-coupling results)
analyze:
  n_rays: 1000          # Number of rays for re-optimization
  coupling_threshold: 0.35  # Minimum coupling to analyze
  results_file: results/2025-11-07_combine_differential_evolution_argon/results_combine_2025-11-07_combine_differential_evolution_argon.csv    # Path to results CSV file (null = required on CLI)
  methods:              # Optimization methods to test on each combination
    - differential_evolution
    - dual_annealing
    - nelder_mead
    - powell
    - grid_search
    - bayesian

# Wavelength analysis settings (test fixed geometry across wavelengths)
wavelength:
  wl_start: 150         # Starting wavelength (nm)
  wl_end: 300           # Ending wavelength (nm)
  wl_step: 10           # Wavelength step (nm)
  n_rays: 1000          # Rays per wavelength test (higher = more accurate)
  results_file: results/analyze_2025-11-07_coupling_0_35_air/results_analyze_combined_analyze_2025-11-07_coupling_0_35_air.csv    # Path to results CSV file (null = required on CLI)
  methods:              # Optimization methods for calibration at 200nm
    - differential_evolution
    - dual_annealing
    - nelder_mead
    - powell
    - grid_search
    - bayesian

# Wavelength plot settings (for wavelength-analyze-plot mode)
wavelength_plot:
  results_dir: results/wavelength_analyze_2025-11-10     # Path to wavelength analysis results directory (null = required on CLI)
  fit_types: 'all'         # List of fit types: ['polynomial', 'spline'], 'all' (for no fit + polynomial + spline), or [] for no fits
  aggregate: false      # Generate aggregated plots (per-lens, per-method)

# Dashboard settings (for web dashboard mode)
dashboard:
  port: 5000            # Web server port
  db_path: null         # Path to database (null = auto-detect)
  auto_open: false      # Auto-open browser on start (future feature)

